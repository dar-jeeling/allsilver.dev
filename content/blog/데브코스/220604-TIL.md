---
title: '220604~05 TIL'
date: 2022-06-05 01:45:39
tags: ['TiL']
category: '데브코스'
draft: false
---

🎃 = 개인의견 ↑↑

## Today I Learned

### 웹 보안 공격

- 웹 보안 공격이란 웹 사이트의 취약점을 공격하는 기술적 위협으로, 웹 페이지를 통하여 **권한이 없는 시스템에 접근** 하거거나 **데이터 유출 및 파괴** 와 같은 행위를 말한다.
- 🎃 개인적으로 서버와 클라이언트가 데이터를 주고 받는 이 과정에서 부터 취약점이 생기는 포인트라고 생각한다. 이 과정속에서 1\. 클라이언트에서 데이터를 들고 있으면 어떤 방식으로든 노출될 수 밖에 없고 2. 서버와 클라이언트의 통신 과정에서 데이터를 갈취한다거나 3. 혹은 이 과정에서 무언가를 심어둘 수 있는 등등의 여러가지 취약점이 생긴다. 즉, 서버와 클라이언트의 통신 과정에서 언제든지 중간에 유저가 끼어들 수 있고, 이 유저가 공격을 할 수도 있는 것이다.

  따라서, 웹 보안 공격에 대해 이해를 할 때, 어느 부분에서 취약점이 생기는지를 위주로 생각을 해보도록 하겠다.

### SQL Injection

![](https://blog.kakaocdn.net/dn/cbi9V1/btrDWKZnCjN/yUm4MsJIVEvfPaB7jw0FBk/img.png)출처 (https://xkcd.com/327/)

- 위의 만화 같은 경우, `ROBERT')'DROP TABLE Student` 라는 SQL을 삽입하게 되면서

  Student DB에 다음과 같은 쿼리가 실행되게 된다.

  `INSERT INTO Student (name) VALUES ('ROBERT'); DROP TABLE Students; --);`

  여기서,

  **첫번 째 줄** 에서 name column에 ROBERT이라는 이름이 삽입되지만,

  **두번 째 줄** 에서 DROP TABLE을 통하여 student DB가 제거되고

  **세번 째 줄** 에서 뒤에 오는 내용을 모두 주석 처리하게 되면서


    student DB를 모두 날려버리게 되는 것이다.

- 즉, 위의 예시 처럼 **SQL Injection 이란 서버에서 실행되는 SQL을 악의적으로 이용한다. 즉, 기본 SQL에 악의적인 SQL을 삽입한다.**
- 🎃 이는 SQL에서 "쿼리를 날리면, 쿼리에 대하여 데이터 베이스의 값이 검색이 된다" 라는 특징에 기인한다. 따라서 SQL에서는 쿼리만 잘 날리면 어떤 식으로든 데이터 베이스의 특정 데이터에 접근이 가능해지는 것이다. 또한 당장 SQL 다룰 때 UPDATE나 DELETE 같은거 잘못 사용하면 데이터가 날라가는걸 생각만 해본다면... 이를 이용해서 다른 사람이 데이터를 날려먹게 할 수 있다.
- SQL Injection 을 방어하기 위해서는 우선 SQL에서 특별한 의미를 가지는 문자를 이스케이프 처리하고

  🎃 즉, 기본적으로 유저한테 받은 값을 직접 SQL로 넘기지 않는다. 유저에게 값을 받을 때, 따로 이스케이프와 같은 후처리를 하여, SQL의 쿼리로 들어가지 않게 한다.

- DB에서 제공하는 placeholder(여기에는 값이 들어간다, 변수와 비슷한 의미), 준비된 선언(prepared statement)을 사용한다.

  🎃 prepared statement 란, 자주 사용되는 SQL을 데이터베이스가 이해하기 쉬운 형태로 해석해 놓은 것이다. 따라서 이 SQL 쿼리와 사용자의 입력문이 분리되게 된다. (즉, 사용자가 이상한 sql 쿼리문을 입력하더라도 이게 sql 쿼리문으로 해석되는게 아니라 말 그대로 string 으로 해석된다)

### Error based SQL Injection

- 일부러 SQL 에러를 발생시켜서 원하는 정보를 취득한다.
- 🎃 옛날 웹사이트의 경우는, SQL 에러가 발생하면 그대로 웹사이트에서 노출되었다고 한다. 즉, 웹 사이트의 에러페이지로 디버깅을 할 수 있었고... 이를 이용해서 DB의 모습을 재현할 수 있다.

### Blind SQL Injection

- 쿼리 결과의 참 거짓을 보고 원하는 정보가 존재하는지 확인한다.
- 🎃 노가다이다. 정보를 직접적으로 알아내는게 아니라 True/False 값을 통해 정보를 간접적으로 알아낸다.

  예를 들면, 내부적으로

  `SELECT * FROM users WHERE user_id = '1' and substring(database(), 1, 2)='us'#`

  과 같은 쿼리가 요청되도록 하면, DB의 첫번째 글자부터 두 번째 글자가 us인지 True/False를 반환하게 되고,

  이 결과를 통하여 DB의 전체 이름을 유추하게 된다. (즉, 위의 예제에서는 db이름(users)의 1,2 번째 글자가 us가 아니므로 False를 리턴하게 되고, True가 나올 때까지 문자열의 조합을 바꿔나가면서 쿼리를 날릴 수 있다)

### Union SQL Injection

- SQL의 UNION 명령을 이용하여 정보를 취득한다.
- 🎃 예를 들면

  `SELECT * FROM users WHERE user_id = '1' or 1=1 UNION SELECT ", id, pwd from users#`

  와 같은 쿼리가 요청되도록 하면, UNION 명령을 통하여 UNION 앞 뒤로 오는 두 쿼리,

  `SELECT * FROM users WHERE user_id = '1' or 1=1`

  `SELECT ", id, pwd from users#"`

  을 합친 결과를 출력하도록 한다.


    이렇게 하면 모든 users의 id, pwd가 반환된다.

### XSS (Cross-Site Scripting)

- XSS는 웹 사이트에 악성 스크립트를 삽입하는 공격이다.예를 들어 게시판에 `<script>` 태그를 사용하여 악성스크립트를 넣으면, 이게 실행되면서 게시판 이용자가 글을 읽을 때 토큰을 탈취할 수 있다.
- 🎃 사실 웹 사이트가 아닌 환경에 (특히 온라인 게임이나 모바일 게임에)  `#색상코드` 를 사용하고 아래에 텍스트를 입력하거나 `[16진수색상코드]` 를 사용하고 옆에 닉네임을 쓴다던가, 아니면 `<size=크기><color=색상코드>넣고 싶은 값</color></size>` 와 같은 값을 넣어서 살짝 커스터마이징을 할 수 있는데... 이거랑 비슷한 원리로 실행되는게 아닌가 싶다.

![](https://blog.kakaocdn.net/dn/tI3iT/btrD2HbdJwx/NOsCUqYalfkAOdd6UYJfk0/img.png)

- XSS 를 방어하기 위해 HTML 필터링을 한다.

  🎃 지금 내가 사용하고 있는 블로그 플랫폼인 TISTORY의 경우, < 와 같은 문자를 입력하고 HTML 탭에서 확인하면 &lt; 로 자동으로 필터링 되는 것을 확인할 수 있는데, 아마 XSS를 막기 위한 일환이 아닐까? 싶다

![](https://blog.kakaocdn.net/dn/05F1A/btrD2HbdrkK/X47cjjkOHQZaUP17ND8rk0/img.png)티스토리의 문자 필터링

### Reflected XSS

- 검색어 등을 보여주는 곳에 스크립트를 심어둔다. 사용자가 검색어에 접근하는 URL을 누르면 공격에 성공한다.

### DOM Based XSS

- DOM에 악의적인 스크립트를 심는다. 예를 들면 `image` 태그의 `src` 어트리뷰트에 자바스크립트 코드를 넣으면 이 DOM이 로드되면 script가 실행되면서 공격당하게 되는 것이다.

### CSRF Attack (Cross-Site Request Forgery)

- 인터넷 사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격이다.
- 자세하게 어떤 식으로 동작하냐면, 공격자가 사용자에게 가짜 피싱사이트(로그인 페이지라고 가정)에 들어가도록 유도하고, 사용자가 가짜 피싱사이트에 로그인을 하게되면, 이 피싱 사이트는 진짜 사이트에 요청을 하게 되고, 진짜 사이트는 정보에 대하여 실패인지 성공인지 응답하게 되고, 이 응답을 통하여 정보를 탈취할 수 있다.
- 🎃 이런 방식으로 페북에 이상한 광고글을 내 의지와 상관없이 쓴다던가...의 일이 발생할 수도 있다.
- 이러한 CSRF Attack은 1. 허용된 도메인만 요청 허락하도록 설정하거나, 2. CSRF Token을 이용하여, 클라이언트와 서버의 상호작용에서 토큰을 첨부하면서 verification을 함으로써 방어할 수 있고 3. CAPTHA를 이용하여 진짜 사람이 요청했는지 확인할 수 있다.

### Command Injection

- 애플리케이션에 사용되는 시스템 명령어에 악의적인 명령어(ifconfig 처럼 ip주소를 알아낸다던가, sudo 권한이라던가)를 삽입한다. 이러한 명령어를 통하여 web을 통하여 해당 시스템의 shell에 접근할 수도 있다.

### File Upload Attack

- 악성 스크립트 파일을 업로드하고, 특정 경로로 접근하면 스크립트를 실행하게 한다.

### Javascript Injection

- Client Side 에서 Javascript를 삽입한다. 이는 client side에서 데이터를 저장한 후, 서버에 올리는 방식을 사용하면 특히나 위험하다.
- 🎃 옛날옛적 주니X네이X의 동X농장의 치X오메틱을 사용한 탐험 버그가 이 방식인듯하다. 아마도 웹 게임이기 때문에 탐험에서 얻는 돈을 클라이언트에서 저장한 후에 꽤 오랜시간 뒤에 서버에 데이터를 보내고 동기화하는 방식인 것 같은데, 치X오메틱을 사용하여, 클라이언트 사이드에서 DB의 돈을 조작하고나면(그리고 이 DB의 col type은 signed int 였던 것 같다. 21억 이상의 돈을 넣으면 마이너스가 나오기 때문에) 그대로 내가 그 돈을 가지게 되는 그런 방식인 듯 하다.

### DDOS (Distributed Denial Of Service)

- 서버에 비정상적으로 많은 트래픽을 보내서, 서버에 오버헤드를 인위적으로 발생시켜서 서버를 마비시킨다.
- 🎃 이런 공격을 막기 위하여 Rate Limit를 제한하는 SNS 서비스가 상당히 많은데.... 트위터의 경우 이상하게 ios에서 Rate Limit가 이상하게 잡히는 버그가 있는 것 같다. ios에서 트위터를 사용하는 경우 API 이용 제한이 뜨고 있는데...  왜 그런지는 아직 원인을 찾아볼 수가 없었다...

### Dictionary Attack

### Rainbow Table

- 해시 함수를 이용한 평문을 모두 저장해놓은 표이다. 계정을 탈취한 다음 암호문을 이 표에 대입해서 찾아낸다.

### 보안 정책

### CORS (Cross-Origin Resource Sharing)

- 개발자가 지정한 프로토콜, 도메인, 포트가 아니라면 리소스를 가져올 수 없게 한다. 이는 Response header를 보고 허용 여부를 브라우저가 정한다. (즉, 서버에서 요청 헤더, **Access-Control-Allow-Origin**가 내려오면 이 값을 보고 브라우저가 판단하여 허용 여부를 정하게 된다)

### CSP (Content-Security-Policy)

- 실행 가능한 리소스에 대한 WhiteList를 정한다. 🎃 실행가능한 파일을 미리 정하고, 이 파일들만 실행하게 하는 것이다. 이 WhiteList는 메타 태그 혹은 HTTP Header로 설정이 가능하다.
- XSS 방지에 도움이 된다.

### HTTPS

- HTTP 프로토콜의 암호화 된 버전이다.
- 동작 방식은 다음과 같다. (대칭키 \+ 비대칭키가 합쳐진 방식이다)

  1\. 개발자는 서비스에 대한 공개키와 개인키를 생성한다. (비대칭키, 공개키를 통하여 암호화를 하고, 개인키를 이용해서 복호화를 한다)

  2\. CA 서버는 공개키를 위탁한다.

  3\. CA 서버는 공개키를 보관함과 동시에 CA에서 가지고 있는 개인키를 이용하여 이 공개키를 암호화하여 인증서를 생성한다. (대칭키)

  4\. 개발자는 만들어진 인증서를 보관하여 우리가 서비스하는 서버에 적용한다.

  5\. 사용자는 https 프로토콜을 통하여 서비스하는 서버에 접근할 수 있다. (이는 브라우저에서 CA의 공개키를 보관하고 있기 때문이다, 크롬과 같은 브라우저에서 확인할 수 있다)

  6\. 브라우저는 CA의 공개키를 통하여 데이터를 암호화하고, 이를 서버에 전달한다.

## 회고

- 오늘 특강을 들으면서 지속 가능한 배움에 대해서 고민하게 되었다. 요즘은 그냥 개발 생각밖에 하고 있지 않지만... 사실 이게 미래의 무언가를 깎아먹으면서 달리고 있는게 아닐까 라는 생각도 하였다. 번아웃이 오지 않도록, 쉬는 시간을 정말 잘 챙겨야겠다는 생각이 든다. 그래서 강의 하나만 들음
- 프로젝트 기간 동안 해야할 공부에 우선순위를 생각해보자. 일단 절대로절대로절대로!! 팀원에게 피해를 주면 안되기 때문에... 월-화 요일에는 쿠폰받은 인프런 git 강의를 들을 거고 (이게 최선의 우선순위라고 생각한다) 조금 정돈된 코드를 짜기 위해서 함수형 강의를 듣고, 아마 무한스크롤을 자주 사용할 것 같으므로 무한 스크롤 관련된 강의를 듣고.... 데브코스 내내 듣고 있을듯 이러다가 ㅋㅋㅋㅋ 물론 그 주에 강의가 또 생긴다면 말짱도루묵 이지만... 일단은 조금씩 채워나가도록 하겠다.

## Refererence

> [https://xkcd.com/327/](https://xkcd.com/327/)

> [[SQL인젝션] Prepared Statement를 쓰면 SQL 인젝션 공격이 되지 않는 이유는? | 네이버 블로그](https://m.blog.naver.com/PostView.naver?isHttpsRedirect=true&blogId=skinfosec2000&logNo=220482240245)

> [Union SQL Injection 공격 시연 | 티스토리 블로그](https://jdh5202.tistory.com/639)
