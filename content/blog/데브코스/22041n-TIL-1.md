---
title: '~22041n TIL'
date: 2022-04-16 01:26:17
tags: []
category: '데브코스'
draft: false
---

### 배운 것들

- history API와 SPA

### HighLight

#### SPA

history API 에 대해서 이야기 하기 전에 왜 history API를 배우는지에 대한 문제의식이 필요하다고 생각한다.

물론 더 많은 사용방법도 있겠지만, 우선 history API는 SPA를 구현하기 위해 사용한다. SPA는 왜 사용되게 되었으며, 여기서 왜 history API를 사용하게 되었을까?

#### 라우팅

사실 나는 라우터에서 하는 라우팅을 생각해서... 처음에 듣고 뭔가 하긴 했는데 대충 커다란 의미는 비슷한 개념인거같다. 어쨌든 **경로를 찾아주는 것** 을 뜻한다. 그렇다면 프론트엔드에서 경로를 찾아준다는 것은 뭘 뜻할까? 브라우저에서 경로는 URL이라고 할 수 있다. 즉, 이 URL을 찾아갔을 때, URL에 맞는 화면을 보여주는 것이 프론트엔드에서 라우팅..이라고 생각하면 될 듯하다.

옛~날에는 이러한 URL 하나하나 서버에 요청을 보내고, 서버에서 응답을 받아서 그려주는 식으로 라우팅을 하였지만 서버와 통신하는 부분부터 뭔가 문제가 있을 것 같지 않나?

**왜 등장했는지**

SPA는 Single Page Application 이라는 뜻이다. 어떤 웹 사이트가 있다고 할 때, 그 페이지에서 동적으로 화면을 그려가면서 표현한다.

과거에는 클라이언트에서 anchor 태그를 통하여, href를 서버에 요청하고, 서버는 그에 대한 응답을 하고 그 내용을 클라이언트가 브라우저에 표현하는 식으로 동작하였다. 이걸 SSR(Server Side Rendering)이라고 한다.

여기서 문제는.. 페이지가 이동할 때 마다, 서버에 보내는 과정이 생긴다는 것이다. 네트워크를 타고 서버에 보내는건 네트워크 때문에 걸리는 시간도 시간이지만, 서버에 요청을 보내면 보낼 수록 서버가 과부화가 생길 것이다.

따라서 링크를 타고 다니면서 서버와 통신하면서 브라우저에 화면을 그려다니는 것과 달리, 클라이언트에서 페이지를 그려가기 시작하였다.

#### History

따라서, 우리의 목표는 정리하면, 한번 페이지가 렌더링된 이후 부터는 서버에 요청없이 페이지를 이동하는 것이다. 이를 프론트엔드 단에서 구현하기 위하여 history api를 이용한다.

![](https://blog.kakaocdn.net/dn/bEOLT2/btrzvAmZsjJ/J9ijY4ZzjgKmy2i7lxjyYK/img.png)대충 이거임

브라우저에서는 페이지 이동을 할 때 마다 세션 히스토리를 가지고, 이 히스토리는 stack 형태로 쌓이게 된다. 이를 통해서 뒤로 가기나, 앞으로 가기를 할 수 있다.

- **기본적인 기능들**

  \- history stack을 조작하는 것 : back(), foward(), go()

  \- **주소창 URL을 직접 조작하는 것 : pushState, replaceState**

  \- history 객체가 가지는 변수 : state, length

- 여기서 주소창 URL을 직접 조작하는 것에 주목한다. 우리의 목표는 **서버에 요청하지 않고 페이지를 이동하는 것**이다. 다시말하면 화면을 이동하지 않고, url을 바꾼 후, 그 url에 따라 화면을 그려준다. 한번 더 정리하면, **URL을 직접 조작한 다음, 그 URL을 인식하여 화면에 올바른 요소를 그려나가야한다**는 것이다.
- **어떻게 동작하냐**

  history는 stack의 형태를 가지고 있다. 페이지를 이동할 때 마다, stack에 이 요소들이 쌓이게 된다. 주소창 URL을 직접 조작하는 pushState(state, title, url)와 replaceState(state, title, url)에 주목해보자. **push** State라는 이름에서 알다싶이, history stack 에 url에 해당하는 것을 push 한다. replaceState는 앞에 있는 요소를 parameter로 받은 url로 대체한다. 이걸 조금 더 stack 답게 설명하자면 맨 앞에 있는 요소를 pop한 후, url에 해당하는 값을 push 한다. 따라서, 이 때는 직전의 요소가 pop되어 사라졌으므로 뒤로가기를 제한하거나 할 때 사용한다.

- **그러면 어떻게 이걸로 SPA를 구현하냐**

  간단하게 말하면 pushState나 replaceState로 url을 조작한 다음, 그 url에 해당하는 요소를 그린다.

  조금 더 구체적으로 설명하면 다음과 같다.

  1\. URL으로 이동하는 a태그를 만든다. 단, 화면 이동은 일어나지 않게한다.

  2\. 이 URL을 가져와서 pushState나 replaceState를 통해 history stack에 해당 url을 넣는다.

  이렇게 하면, 화면 이동 없이 URL만 변하게 된다.

  3\. 이 URL에 따른 route 로직을 작성한다.

  4\. 또한, 앞으로가기나 뒤로 가리를 처리하기 위해 window.popstate을 핸들링 해서 route 로직을 호출한다.

### 회고

당분간 TIL이 비동기적으로 주제별로 올라올 예정

그러면 이미 TIL이 아니지 않냐고요?

배움을 기록한다는 의미에서 퉁치기로 해요
